% !TEX root = ../Thesis.tex
\acresetall
\myChapter{Discussion}\label{ch:discussion}
\begin{flushright}{\slshape And as soon as I'm done with these waffles, I shall discuss my evil plan!} \\ \medskip
	--- \defcitealias{Zim}{Invader Zim}\citetalias{Zim} \citep{Zim}
\end{flushright}
\begin{flushright}{\slshape No discussion!} \\ \medskip
	--- Jean Reno as\defcitealias{Leon}{Léon}\citetalias{Leon} \citep{Leon}
\end{flushright}
\vspace{52mm}
The tomographic data obtained at the beamline for \ac{tomcat} offers an unmatched three-dimensional insight into the mammalian lung. Even if higher resolution images of the terminal airway ends than the ones obtained at \ac{tomcat} have been obtained with scanning \ac{em}\todo{citation/nice image? $\rightarrow$ Dani Studer?}, these images only provide a view of the surface structure of a sample and are not suited for a full three-dimensional reconstruction of the terminal airway ends. Using standard \ac{em} is impossible to visualize the larger three-dimensional structure of the terminal airway ends inside the lung since the sample has to be sectioned prior to acquiring images using this method, which essentially destroys the full three-dimensional information and makes it impossible to reconstruct larger volumes of the lung structure\todo{Should I mention \threed \ac{em}-tomography?}

Tomography in contrast offers a non-destructive insight into the lung, tomographic microscopy using \ac{uct} enables the study of the major airways of swine~\cite{Litzlbauer2006}, rat~\cite{Langheinrich2004a,Sharif2010} or mice lung~\cite{Langheinrich2004,Ritman2005} and while \ac{srxtm} and \ac{wf-srxtm} enable the study of the functional lung units of the lung, the so-called acini with unmatched resolution and precision.

In this work three imaging methods based on ultrahigh resolution tomographic data of the terminal airway have been presented, the following sections discuss the major notable points of each of them.

\section{Multimodal Imaging}
The method presented in \autoref{ch:xrm2008} combines the advantages of tomographic imaging and \ac{em} into a multimodal imaging approach for the analysis of inhaled particles in the lung. The tomographic data provides the unrestricted three-dimensional information on the location of sub-micron particles in the terminal airway tree which is combined with the extremely high resolution of the \ac{em}-images for the precise analysis of those particles in the lung tissue.

Exposure to ultra-fine particles and nanoparticles produces by environmental or industrial sources is an important health problem. It is expected that inhaled particles are deposited in specific locations in the lung\todo{citation $\rightarrow$ Christian Mühlfeld?}. With currently available methods, the exact location of these deposition sites in relation to the airways tree cannot easily be analyzed. 

Classic histological sections analyzed using light and electron microscopy allow for a precise location of the inhaled particles in relation to the tissue, \ie make it possible to analyze the interaction of the particles with alveolar macrophages and epithelial cells~\cite{Muhlfeld2008}. But the precise localization of these interaction sites inside the airway tree are impossible to extract using histological sections since the three-dimensional structure of the sample is destroyed.

Registration of classic histological slices with the three-dimensional data obtained through \ac{srxtm} make it possible to localize sites of interaction along the airway tree inside the three-dimensional structure of the terminal airways. The method presented in \autoref{ch:xrm2008} was only little more than a proof of concept in terms of the registration between the two imaging modalities. Careful alignment of the sample prior to physical sectioning made registration straightforward, since the images only needed to be corrected for rotation and translation to be able correlate between a physical slice imaged using \ac{em} and a virtual slice of the \ac{srxtm} dataset.

\autoref{fig:correlation} shows the three-dimensional situation of different alignment situations of the two multimodal datasets. The situation shown in \autoref{subfig:correlation-planar} can be achieved through careful alignment of the sample prior to histological sectioning and corresponds to the situation presented in \autoref{ch:xrm2008}. The fully unrestricted three-dimensional information of the airway tree can be matched with highest resolution two-dimensional information about the particle location in or around the tissue in the lung.

Figures~\ref{subfig:correlation-arbitrary1} and \ref{subfig:correlation-arbitrary3} depict situations where the two datasets are arbitrarily orientated with one or multiple degrees of rotation, respectively.

\renewcommand{\imsize}{\linewidth}%
\begin{figure}[p]
	\centering%
	\pgfmathsetlength{\imagewidth}{\imsize}%
	\pgfmathsetlength{\imagescale}{\imagewidth/1586}%
	\def\x{1160}%
	\def\y{364}% scalebar-y at 90% of height of y=404px
	\subfloat[Planar orientation of slice]{%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/discussion/R108C21Bt-mrg-planar}};
			% 515px = 4.3423mm > 100px = 844um > 59px = 500um, 12px = 100um
			%\draw[orange,|-|,thick] (537,266) -- (1043,172) node [sloped,midway,above] {\SI{4.3423}{\milli\meter} (2934px)};
			\draw[|-|,thick] (\x,\y) -- (\x+118,\y) node [right] {\SI{1}{\milli\meter}};
		\end{tikzpicture}%
		\label{subfig:correlation-planar}%
		}\\%
	\subfloat[Arbitrary orientation of slice, one degree of freedom]{%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/discussion/R108C21Bt-mrg-arbitrary1}};
			% 515px = 4.3423mm > 100px = 844um > 59px = 500um, 12px = 100um
			%\draw[white,|-|,thick] (537,266) -- (1043,172) node [sloped,midway,above] {\SI{4.3423}{\milli\meter} (2934px)};
			\draw[|-|,thick] (\x,\y) -- (\x+118,\y) node [right] {\SI{1}{\milli\meter}};
		\end{tikzpicture}%
		\label{subfig:correlation-arbitrary1}%
		}\\%
	\subfloat[Arbitrary orientation of slice, multiple degrees of freedom]{%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/discussion/R108C21Bt-mrg-arbitrary3}};
			% 515px = 4.3423mm > 100px = 844um > 59px = 500um, 12px = 100um
			%\draw[white,|-|,thick] (537,266) -- (1043,172) node [sloped,midway,above] {\SI{4.3423}{\milli\meter} (2934px)};
			\draw[|-|,thick] (\x,\y) -- (\x+118,\y) node [right] {\SI{1}{\milli\meter}};
		\end{tikzpicture}%
		\label{subfig:correlation-arbitrary3}%
		}%
	\caption[Multimodal Imaging]{Multimodal Imaging: Alignment of datasets from two imaging modalities. Left: Sample from \ac{srxtm} with overlaid \ac{em} image (gray-scale inverted, thus dark slice). Center: Five independent airway segments have been extracted and are three-dimensionally visualized with overlaid \ac{em}-image. Right: \ac{em}-image shown with three-dimensional orientation in relation to the \ac{srxtm} dataset. \subref{subfig:correlation-planar}: Planar orientation of the slice obtained with the second imaging modality. Through careful orientation of the sample prior to sectioning a registration is straightforward, since only the rotation in the plane of the slice and the different magnification have to be taken into account. \subref{subfig:correlation-arbitrary3}: Pitch-angle~\cite{YawPitchRoll} rotation between the two datasets. \subref{subfig:correlation-arbitrary3}: Pitch and roll rotation between the two datasets.}%
	\label{fig:correlation}%
	\todo[inline]{Slice is not multimodal but from \ac{srxtm}-set, so essentially I'm lying\dots $\rightarrow$ Do we need to show a LM or EM-slice or is this enough for concept?}%
\end{figure}

Current work in our group focuses on an automatic registration method taking into account all six degrees of freedom \ie rotation and translation in the x, y and z-plane. First results have already been presented as a master thesis by Sébastien \citet{Barre2009}.

\section{Finite element reconstruction of the terminal airways}
The results presented in \autoref{ch:tsuda2008} focus more on the structural analysis of the gas-exchange region of the lung. The alveolar structure of the pulmonary acinus plays a vital role in gas exchange function. Using an analytical method which mapped a \ac{fe} representation of the terminal airways over a three-dimensional reconstruction of a \ac{srxtm} dataset we accurately reconstructed the gas exchange regions of the lung in three dimensions with ultrahigh resolution of \SI{1.48}{\micro\meter} per voxel.

To our knowledge it has never before been possible to three-dimensionally analyze the structure-function relationship of the parenchymal region of the lung in such detail. \citet{Berend1991} performed an analysis of the peripheral region of one human lung using serial sections studied by light microscopy. They were able to analyze the structure of one partical acinus through formidable effort and stated that the process proved to be very difficult and time consuming. \citet{Litzlbauer2006} analyzed porcine lungs using \ac{uct} but suggest to favor \ac{srxtm} over \ac{uct} to enhance the quality of morphometric analysis of the terminal airway structure.

Using \ac{srxtm} it has not only been possible to visualize the alveolar region of rat lung samples, but also to assess and match morphological parameters of the computed three-dimensional reconstruction to prior stereologically assessed parameters of these lungs.

Since the reconstructed datasets have been directly elementarized using a \ac{fe} mesh lung tissue and air space were not only three-dimensionally visualized, but also immediately prepared for further analysis of the terminal airway region. Different morphological parameters were assessed and the \ac{fe} meshing prepared the resulting dataset for subsequent \ac{cfd} analysis of the airflow in the lung.\todo{moar?}

\section[WF-SRXTM]{Widefield synchrotron radiation based x-ray tomographic microscopy}
The \ac{wf-srxtm} results presented in \autoref{ch:haberthuer2010} make it possible to image much larger lung samples than with conventional \ac{srxtm}. Prior to this \ac{wf-srxtm} scanning method, obtaining tomographic datasets relied on luck, with the increase in field of view tomographic images of full acini in the terminal airways can be routinely obtained. Since the results presented in \autoref{ch:haberthuer2010} almost exclusively focus on the engineering and technical background of the method, I would like to additionally highlight biological results achieved applying \ac{wf-srxtm} on rat lung samples in the following sections of this chapter instead of an additional discussion of the method.

We routinely performed more than 70 \ac{wf-srxtm} scans of different rat lung samples. Using a region growing algorithm multiple independent airway segments have been extracted from those datasets and the structure of these airway segments has been visualized using a skeletonization algorithm built into MeVisLab~\cite{Bitter2007}, the development environment for medical image processing and visualization which I have been using almost exclusively for the analysis and visualization of the tomographic datasets during my work.

\subsection{Skeletonization}
A skeletonization of a structure is performed to extract the underlying information of said structure. The skeleton of a structure corresponds to the local maxima of the distance transformation of this structure, which transforms a binarized image into an image where each pixel gray value corresponds to the distance of this pixel to the nearest boundary. \autoref{fig:skeletonization} explains the whole process in a two-dimensional example. An in-depth explanation of the skeletonization algorithm built into MeVisLab is presented by  \citet{Selle2002}, an application of the algorithm for the morphometric quantification of vessels is presented by \citet{Boskamp2004}.

\renewcommand{\imsize}{\linewidth}%
\begin{figure}[htb]
	\centering
	\pgfmathsetlength{\imagewidth}{\imsize}%
	\pgfmathsetlength{\imagescale}{\imagewidth/2707}%
	\subfloat[Original slice]{%
		\begin{tikzpicture}[remember picture,x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imsize]{img/outlook/skeletonization/1-R108C21Cb-mrg1024}};%
      		\def\x{2300}%
			\def\y{750}%
			\draw[|-|,white,thick] (\x,\y) -- (356+\x,\y) node [midway, above] {\SI{500}{\micro\meter}};%
			\def\OLX{970} \def\OLY{356}%
			\def\URX{1504} \def\URY{820}%
			\draw[color=white, thick] (\OLX,\OLY) rectangle (\URX,\URY);%
    	\end{tikzpicture}%
		\label{subfig:skel-a}%
	}%
	\\%
	\renewcommand{\imsize}{0.25\columnwidth}%
	\subfloat[Binarized]{%
		\includegraphics[width=\imsize]{img/outlook/skeletonization/4-crop-R108C21Cb-mrg1024}%
		\label{subfig:skel-b}%
		}%
	\subfloat[Segmented]{%
	 	\includegraphics[width=\imsize]{img/outlook/skeletonization/5-fill-R108C21Cb-mrg1024}%
		\label{subfig:skel-c}%
		}%
	\subfloat[Distance Transformation]{%
		\includegraphics[width=\imsize]{img/outlook/skeletonization/6-dtf-R108C21Cb-mrg1024}%
		\label{subfig:skel-d}%
		}%
	\subfloat[Skeleton]{%
		\includegraphics[width=\imsize]{img/outlook/skeletonization/9-Skeleton-crop}%
		\label{subfig:skel-e}%
		}%
	\caption[\twod skeletonization]{Two-dimensional skeletonization process: \subref{subfig:skel-a}: Wide field scanned tomographic slice from a rat lung sample obtained at postnatal day 21. The inset corresponds to the region of the images shown in the bottom row. \subref{subfig:skel-b}: Binarized \ac{roi} The data has been separated into tissue and airspace. \subref{subfig:skel-c}: The white segment represents one connected airway structure inside the \ac{roi} in two dimensions. \subref{subfig:skel-d}: Euclidean Distance transformation of the segment shown in panel \subref{subfig:skel-c}, where the gray level value of each pixel represents the distance to the tissue-airspace border. \subref{subfig:skel-e}: The local maxima of the distance transformation form the skeleton which is then overlaid on the binarized lung structure from panel \subref{subfig:skel-a}.}%
	\label{fig:skeletonization}%
\end{figure}

\autoref{fig:skeleton} shows an overview of a successful skeletonization in the three dimensional case. MeVisLab can export the information of the skeleton to an \acsu{xml}-file from which we can obtain the amount of skeleton nodes and their position in space for further analysis. The example in \autoref{fig:skeleton} shows a skeletonization of multiple acini in a rat lung sample obtained at postnatal day 21 containing multiple airway segments which each contain one or more acini. Both these structures are shown in the background. The foreground of the image shows the extracted skeletons containing between \num{1100} and \num{7300} nodes.

\renewcommand{\imsize}{\linewidth}
\begin{figure}[htb]
	\centering
	\pgfmathsetlength{\imagewidth}{\imsize}%
	\pgfmathsetlength{\imagescale}{\imagewidth/1541}%
	\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
		\def\x{1300}
		\def\y{400}
		\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/R108C21b-skeleton}};
		% 796px = 4.0138mm > 100px = 504um > 99px = 500um, 20px = 100um
		%\draw[color=red,|-|,thick] (11,341) -- (807,339) node [sloped,midway,above] {\SI{4.0138}{\milli\meter} (2712px)};
		\draw[|-|,thick] (\x,\y) -- (\x+99,\y) node [midway, above] {\SI{500}{\micro\meter}};
	\end{tikzpicture}%
	\caption[\threed Visualization of rat lung sample]{Three-dimensional visualization of rat lung sample obtained at postnatal day 21. Left: Three-dimensional view of the sample, Right: Four independent airway segments. Foreground: Extracted airway skeletons of the independent airways. The yellow skeleton contains \num{1133}, the green \num{7288}, the red \num{6513} and the blue skeleton \num{3278} nodes.}
	\label{fig:skeleton}
\end{figure}

Extracting the indipendent airway segments as shown in \autoref{fig:skeleton} would not have been possible using classic tomography at \ac{tomcat}. Additional results generated using the widefield scanning method, the stereological analysis of the tomographic data are presented in the following section.

\subsection{Stereological analysis of the tomographic data}
As mentioned in \autoref{ch:Introduction}, the interrelation of the acini in the lung tissue cannot be analyzed using classical sectioning methods, since the three-dimensional information of the airway structure is destroyed. Using a region growing method multiple independent airway segments were extracted from the three-dimensional \ac{wf-srxtm} datasets.

Using a method coined ``man hole covering'' the airway segments have been subdivided into single acini, \ie the entrance of the acinus or the border between the purely conducting and the gas-exchanging reguion has been closed. This made it possible to stereologically analyze the number of alveoli independently for each acinus\todo{Elaborate a bit more on this: Acinus detection \threed, marking in \twod makes it ``more understandable'' than on classic slices}. See \autoref{fig:acinus overlay} for a slice with colorcoded individual acini overlaid over the tomograpic slice.

\renewcommand{\imsize}{0.5\linewidth}
\begin{figure}[htb]
	\centering
	\pgfmathsetlength{\imagewidth}{\imsize}%
	\pgfmathsetlength{\imagescale}{\imagewidth/1085}%
	\def\x{671} % scalebar-x at golden ratio of x=1085px
	\def\y{789} % scalebar-y at 90% of height of y=877px
	\subfloat[Übersicht]{%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/discussion/10a_1}};
			% 1026px = 4.3423mm > 100px = 423um > 118px = 500um, 24px = 100um
			\draw[|-|,thick] (1058,496) -- (42,350) node [sloped,midway,above] {\SI{4.3423}{\milli\meter} (2934px)};
			\draw[|-|,thick] (\x,\y) -- (\x+118,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}} node [midway, above] {\SI{500}{\micro\meter}};
		\end{tikzpicture}%
		}%
	\subfloat[Segmente]{%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/discussion/10a_2}};
			% 1026px = 4.3423mm > 100px = 423um > 118px = 500um, 24px = 100um
			%\draw[|-|,thick] (1058,496) -- (42,350) node [sloped,midway,above] {\SI{4.3423}{\milli\meter} (2934px)};
			\draw[|-|,thick] (\x,\y) -- (\x+118,\y) node [midway, above] {\SI{500}{\micro\meter}};
		\end{tikzpicture}%
		}%
	\caption[Manhole cover method]{Manhole cover method: Multiple acini have been separated from the main airway segment.}
	\label{fig:3d-10a}
	\todo[inline]{make nice figure showing manhole covers!}
\end{figure}

\todo[inline]{Do we really need to explain the stacking? Or is it enough to just mention it below?}
Additionally to increasing the field of view in lateral direction, as presented in \autoref{ch:haberthuer2010} we performed so-called stacked scans (as shown in \autoref{subfig:stacked}), where multiple \ac{wf-srxtm} scans (as shown in \autoref{subfig:wfs}) are acquired on top of each other without user intervention. We performed these socalled stacked scans because we noticed that the lung acini seem to be growing over the course of the lung development\todo{show ATS2009-Poster images with independent airway segments over days 4, 10, 21, 36 \& 60.}

\def\scale{0.618}
\begin{figure}	[htb]
	\noindent\makebox[\textwidth]{%
		\centering
		\subfloat[Stacked Scan]{%
			\input{TikZ-Files/wfs-stacking}%
			\label{subfig:stacked}%
			}%
		\hspace{4mm}%
		\subfloat[Widefield Scan]{%
			\input{TikZ-Files/wfs-widefieldscanning}%
			\label{subfig:wfs}%
			}%
	}%
	\caption[Stacked vs.\ Widefield Scan]{Stacked vs.\ Widefield Scan. \subref{subfig:stacked}: Vertical increase of the field of view; Stacking two or more tomographic scans on top of each other can be achieved fairly easily with precise sample positioning. \subref{subfig:wfs}: The method presented in \autoref{ch:haberthuer2010} laterally increases the field of view. Multiple widefield scans can be stacked on top of each other as shown in panel \subref{subfig:stacked} to increase the field of view both in horizontal and vertical direction.}%
	\label{fig:stack}%
\end{figure}

The resulting images size of such a stacked wide field scan are in the order of 3000$\times$3000$\times$3000 pixels, at an isometric voxel size of \SI{1.48}{\micro\meter}. Using such stacked wide field scanning datasets permitted us to analyze the structure of the terminal airway ends.
\todo[inline]{Do we really need to explain the stacking? Or is it enough to just mention it above?}

\subsection{STEPanizer}
Explain the STEPanizer~\cite{Tschanz2010}, which has been used by Lilian and the WahlPraktikums-Students for the analyis of the \# of acini per volume.

Segmented slices (see \autoref{fig:acinus overlay} after application of ``Manhole Cover''-method with MeVisLab made the relationship of the acini visible on the two-dimensional slices. This subsequently made it possible to actually count the bridges---corresponding to the alveolar entrance rings---and make a plot of the relation of the $\frac{\textrm{Acini}}{\textrm{Volume}}$ over the lung development, as shown in \autoref{fig:plot}\todo{Discuss the results in comparison with the old result by Burri/Schittny}.

\renewcommand{\imsize}{0.618\linewidth}
\begin{figure}[htb]
	\centering
	\includegraphics[width=\imsize]{img/Acinus_Overlay}
	\caption{Acinus Overlay}
	\label{fig:acinus overlay}
\end{figure}

\begin{figure}[htb]
	\noindent\makebox[\textwidth]{%
		\centering
		\begin{tikzpicture}
		\begin{axis}[%
			width=\linewidth,%
			height=0.618\linewidth,%
			xtick=data,%
			xlabel=Days,%
			ylabel={Alveoli per Volume [\micro\litre$^{-1}$]}%
			]
			\addplot
				plot[error bars/.cd, y dir = both, y explicit]
				coordinates{
				 ( 4,  830.227199) +- (0,161.2552418)
				 (10, 2137.703946) +- (0,711.2699504)
				 (21, 4257.621073) +- (0,894.2126898)
				 (36, 1405.273483) +- (0,199.9066289)
				 (60, 1072.860829) +- (0,75.20238908)
				};
			\draw node at (axis cs:4,830.227199)	[anchor=south] {**};
			\draw node at (axis cs:10,2137.703946)	[anchor=south] {**};
			\draw node at (axis cs:21,4257.621073)	[anchor=south] {**};
			\draw node at (axis cs:36,1405.273483)	[anchor=south] {**};
			\draw node at (axis cs:60,1072.860829)	[anchor=south] {*};
		\end{axis}
		\end{tikzpicture}%
	}
	\caption[Alveolar entrances per volume]{Alveolar entrances per volume. Multiple airway segments per day have been counted using the STEPanizer. Volumes of the segments have been evaluated using MeVisLab. The average of the alveoli (bridges) per volume for each day has been plotted. The error bars show the calculated standard deviation based on the entire population. The probability associated with a Students's t-Test $p$ calculated between the single days is $p_{4:10}=0.0056$, $p_{10:21}=0.0007$, $p_{21:36}=0.0017$ and $p_{36:60}=0.0358$. ** denotes a p-value $p<0.01$, * denotes $p<0.05$.}
	\label{fig:plot}
\end{figure}
